{%- capture prem_btn -%}
{%- if b_i.show_custom_html -%}
{{ b_i.custom_html }}
{%- if b_i.show_prem_btn -%}
<div class="custom-buttons" data-offset="{{ b_i.buttons_top_offset }}" data-offsetmedium="{{ b_i.buttons_top_offset_medium }}">
  {%- if b_i.show_prem_btn_1 -%}
  <a href="{{ b_i.link_1 }}"
     class="btn custom-buttons-btn-1"
     >{{ b_i.text_b_1 }}</a>{%- endif -%}
  {%- if b_i.show_prem_btn_2 -%}
  <a href="{{ b_i.link_2 }}"
     class="btn custom-buttons-btn-2"
     >{{ b_i.text_b_2 }}</a>{%- endif -%}
</div>
{%- endif -%}
{%- endif -%}
{%- endcapture -%}

{%- assign bg_alpha = b_i.background_alpha | divided_by: 100.00 -%}
{%- assign bg_color = b_i.cbtnbg | color_modify: 'alpha', bg_alpha -%}
{%- assign bg_alpha_a = b_i.background_alpha_a | divided_by: 100.00 -%}
{%- assign bg_color_a = b_i.acbtnbg | color_modify: 'alpha', bg_alpha_a -%}

{%- assign bor_alpha = b_i.border_alpha | divided_by: 100.00 -%}
{%- assign bor_color = b_i.cbtnbor | color_modify: 'alpha', bor_alpha -%}
{%- assign bor_alpha_a = b_i.border_alpha_a | divided_by: 100.00 -%}
{%- assign bor_color_a = b_i.acbtnbor | color_modify: 'alpha', bor_alpha_a -%}

{%- assign radius = '-moz-border-radius:' | append: item.bg_round | append: 'px;' | append: '-webkit-border-radius:' | append: item.bg_round | append: 'px;' | append: 'border-radius:' | append: item.bg_round | append: 'px;' | append: '-khtml-border-radius:' | append: item.bg_round | append: 'px;' %}

{%- assign img_size2 = img_size | remove: 'x' | times: 2 | append: 'x' -%}

{% capture buttoninuse %}{% if b_i.show_custom_html %}{% if b_i.show_prem_btn %}true{% else %}false{% endif %}{% else %}false{% endif %}{% endcapture %}

{% assign btnanimation = '' %}
{% if b_i.btnanimation %}
{% capture btnanimation %}{% if b_i.position != 'use_main_position' %}{{ b_i.position }}{% else %}{{ item.position }}{% endif %}{% endcapture %}
{% if b_i.text1 == '' and b_i.text2 == '' and b_i.text3 == '' and b_i.btnanimation != 'nobtnanimation' %}
{% assign btnanimation = 'btnanimationtop' %}
{% else %}
{% if btnanimation contains 'tt-point-v-t' %}
{% assign btnanimation = 'btnanimationtop' %}
{% elsif btnanimation contains 'tt-point-v-b' %}
{% assign btnanimation = 'btnanimation btnanimationbottom' %}
{% else %}
{% assign btnanimation = 'btnanimation btnanimationcenter' %}
{% endif %}
{% endif %}
{% endif %}

{% if b_i.use_link and buttoninuse == 'false' %}
<a href="{{ b_i.link }}" class="{{ btnanimation }} respimgsize tt-promo-box{% if b_i.description_size == 'use_main_size' %}{% if item.description_size == 'small' %} tt-one-child{% endif %}{% else %}{% if b_i.description_size == 'small' %} tt-one-child{% endif %}{% endif %}{% if b_i.animation == 'use_main_animation' %}{% if item.animation == 'simple' %} hover-type-2{% endif %}{% else %}{% if b_i.animation == 'simple' %} hover-type-2{% endif %}{% endif %}{% if item.zoomimageeffect %} zoomimageeffect{% endif %}" {% if item.show_border %}style="border: {{ item.border_color }} solid 1px"{% endif %} data-hovercolors>
{% else %}
<div class="{{ btnanimation }} respimgsize tt-promo-box selecttext{% if b_i.description_size == 'use_main_size' %}{% if item.description_size == 'small' %} tt-one-child{% endif %}{% else %}{% if b_i.description_size == 'small' %} tt-one-child{% endif %}{% endif %}{% if b_i.animation == 'use_main_animation' %}{% if item.animation == 'simple' %} hover-type-2{% endif %}{% else %}{% if b_i.animation == 'simple' %} hover-type-2{% endif %}{% endif %}{% if item.zoomimageeffect %} zoomimageeffect{% endif %}" {% if item.show_border %}style="border: {{ item.border_color }} solid 1px"{% endif %}
     data-hovercolors
     {% if b_i.use_link %} data-linkto="{{ b_i.link }}"{% endif %}>
{% endif %}

    {%- if b_i.image == blank -%}
    {%- include "get_svg" type:'image' size:info_image_size -%}
  {%- else -%}
    {%- comment -%}
      ===== Responsive images optimizadas =====
      - picture con AVIF/WEBP/JPG
      - srcset + sizes (ajusta el “vw” si tus tarjetas ocupan otro ancho)
      - width/height para evitar CLS
      - fetchpriority=high sólo para el primer promo en Home (LCP)
    {%- endcomment -%}

    {%- assign sizes_attr = '(max-width: 767px) 92vw, (max-width: 1199px) 45vw, 30vw' -%}

    {%- assign base_w = 1200 -%}
    {%- if b_i.image.width < base_w -%}{%- assign base_w = b_i.image.width -%}{%- endif -%}
    {%- assign base_h = base_w | divided_by: b_i.image.aspect_ratio | round -%}

    {%- if template == 'index' and forloop and forloop.first -%}
      <link rel="preload" as="image"
            href="{{ b_i.image | image_url: width: 1200, format: 'webp' }}"
            imagesrcset="
              {{ b_i.image | image_url: width: 480,  format: 'webp' }} 480w,
              {{ b_i.image | image_url: width: 768,  format: 'webp' }} 768w,
              {{ b_i.image | image_url: width: 960,  format: 'webp' }} 960w,
              {{ b_i.image | image_url: width: 1200, format: 'webp' }} 1200w"
            imagesizes="{{ sizes_attr }}"
            fetchpriority="high">
    {%- endif -%}

    <picture>
      {%- if b_i.image2 != blank -%}
        {%- assign m_w = 768 -%}
        {%- if b_i.image2.width < m_w -%}{%- assign m_w = b_i.image2.width -%}{%- endif -%}
        {%- assign m_h = m_w | divided_by: b_i.image2.aspect_ratio | round -%}

        <!-- Mobile sources -->
        <source media="(max-width: 767px)" type="image/avif"
                srcset="
                  {{ b_i.image2 | image_url: width: 360, format: 'avif' }} 360w,
                  {{ b_i.image2 | image_url: width: 480, format: 'avif' }} 480w,
                  {{ b_i.image2 | image_url: width: 640, format: 'avif' }} 640w,
                  {{ b_i.image2 | image_url: width: 768, format: 'avif' }} 768w">
        <source media="(max-width: 767px)" type="image/webp"
                srcset="
                  {{ b_i.image2 | image_url: width: 360, format: 'webp' }} 360w,
                  {{ b_i.image2 | image_url: width: 480, format: 'webp' }} 480w,
                  {{ b_i.image2 | image_url: width: 640, format: 'webp' }} 640w,
                  {{ b_i.image2 | image_url: width: 768, format: 'webp' }} 768w">
        <source media="(max-width: 767px)"
                srcset="
                  {{ b_i.image2 | image_url: width: 360, format: 'pjpg' }} 360w,
                  {{ b_i.image2 | image_url: width: 480, format: 'pjpg' }} 480w,
                  {{ b_i.image2 | image_url: width: 640, format: 'pjpg' }} 640w,
                  {{ b_i.image2 | image_url: width: 768, format: 'pjpg' }} 768w">
      {%- endif -%}

      <!-- Desktop/Tablet sources -->
      <source type="image/avif"
              srcset="
                {{ b_i.image | image_url: width: 480,  format: 'avif' }} 480w,
                {{ b_i.image | image_url: width: 768,  format: 'avif' }} 768w,
                {{ b_i.image | image_url: width: 960,  format: 'avif' }} 960w,
                {{ b_i.image | image_url: width: 1200, format: 'avif' }} 1200w">
      <source type="image/webp"
              srcset="
                {{ b_i.image | image_url: width: 480,  format: 'webp' }} 480w,
                {{ b_i.image | image_url: width: 768,  format: 'webp' }} 768w,
                {{ b_i.image | image_url: width: 960,  format: 'webp' }} 960w,
                {{ b_i.image | image_url: width: 1200, format: 'webp' }} 1200w">
      <img
        class="promoimagemain"
        src="{{ b_i.image | image_url: width: 768, format: 'pjpg' }}"
        srcset="
          {{ b_i.image | image_url: width: 480,  format: 'pjpg' }} 480w,
          {{ b_i.image | image_url: width: 768,  format: 'pjpg' }} 768w,
          {{ b_i.image | image_url: width: 960,  format: 'pjpg' }} 960w,
          {{ b_i.image | image_url: width: 1200, format: 'pjpg' }} 1200w"
        sizes="{{ sizes_attr }}"
        width="{{ base_w }}" height="{{ base_h }}"
        alt="{{ b_i.image.alt | escape }}"
        loading="lazy"
        decoding="async"
        fetchpriority="{% if template == 'index' and forloop and forloop.first %}high{% else %}low{% endif %}">
    </picture>
  {%- endif -%}

  {% capture ctbtn %}{%- if b_i.show_custom_html and b_i.use_custom_html_below_text == true -%}true{%- else -%}false{%- endif -%}{% endcapture %}
  {%- unless b_i.description_size == 'hide' -%}{%- if b_i.text1 != '' or b_i.text2 != '' or b_i.text3 != '' or b_i.show_icon or ctbtn!= 'false' -%}
  <div class="tt-description {% if b_i.position != 'use_main_position' %}{{ b_i.position }}{% else %}{{ item.position }}{% endif %}">
    <div class="tt-description-wrapper-main tt-description-wrapper{% if b_i.text_to_left %} text-left{% endif %}"{% if item.use_same_desc_width %} style="min-width: {{ item.same_width }}px"{% endif %}>
      <div class="tt-background" style="background:{{ bg_color }}; border: {{ bor_color }} solid 2px; {{ radius }}" data-bgc="{{ bg_color }}" data-abgc="{{ bg_color_a }}" data-borc="{{ bor_color }}" data-aborc="{{ bor_color_a }}"></div>
      {%- if b_i.show_icon -%}
      {%- assign icon_width = b_i.width | append: 'x' -%}
      {%- assign icon_width2 = b_i.width | times: 2 | append: 'x' -%}
      {%- assign img_size2 = img_size | remove: 'x' | times: 2 | append: 'x' -%}
      <img src="{{ b_i.icon_image | img_url: icon_width }}"
           srcset="{{ b_i.icon_image | img_url: icon_width }} 1x,
                   {{ b_i.icon_image | img_url: icon_width2 }} 2x"
           alt="{{ b_i.icon_image.alt }}"
           >
      {%- endif -%}
      {% if b_i.text1 != '' %}<div class="tt-title-small" style="color:{{ b_i.cbtntext }};" data-c="{{ b_i.cbtntext }}" data-ac="{{ b_i.acbtntext }}">{{ b_i.text1 }}</div>{% endif %}
      {% if b_i.text2 != '' %}<div class="tt-title-large" style="color:{{ b_i.cbtntext2 }};" data-c="{{ b_i.cbtntext2 }}" data-ac="{{ b_i.acbtntext2 }}">{{ b_i.text2 }}</div>{% endif %}
      {% if b_i.text3 != '' %}<div class="tt-title-small-3" style="color:{{ b_i.cbtntext3 }};" data-c="{{ b_i.cbtntext3 }}" data-ac="{{ b_i.acbtntext3 }}">{{ b_i.text3 }}</div>{% endif %}
      
      {%- if b_i.show_custom_html and b_i.use_custom_html_below_text == true -%}{{ prem_btn }}{%- endif -%}
      
    </div>
  </div>
  {%- endif -%}{%- endunless -%}
  
  {%- if b_i.show_custom_html and b_i.use_custom_html_below_text == false -%}
  <div class="tt-description {{ b_i.custom_html_position }}">
    <div class="tt-description-wrapper{% if b_i.text_to_left %} text-left{% endif %}">
      <div class="tt-background" style="background:rgba(0,0,0,0)"></div>

      {{ prem_btn }}

    </div>
  </div>
  {%- endif -%}

{% if b_i.use_link == false or buttoninuse == 'true' %}
</div>
{% else %}
</a>
{% endif %}